# 🔍 통계 페이지 문제 분석 및 해결 방안

## 📋 사용자 피드백 요약

### 1️⃣ 일별 통계 문제점
- ❌ 가로축에 7일 날짜가 표시되지 않음
- ❌ 날짜가 역순으로 표시됨 (최신 → 과거 순서)
- ✅ **기대**: 12/27, 12/28, 12/29, 12/30, 12/31, 1/1, 1/2 (과거 → 최신)

### 2️⃣ 주간 통계 문제점
- ❌ 일별 통계와 차이가 없음 (그래프 종류만 다름)
- ❌ 한 주의 모든 날짜가 표시되지 않음
- ✅ **기대**: 월~일 7일 모두 표시, 일별 통계와 명확한 차별화

### 3️⃣ 월별 통계 문제점
- ❌ 최근 6개월이 아니라 2개월만 표시됨
- ✅ **기대**: 7월, 8월, 9월, 10월, 11월, 12월 (6개월 전체)

---

## 🔍 원인 분석

### 1️⃣ 일별 통계 문제 원인

#### Backend API (stats.ts)
```typescript
// Line 37: 역순 정렬
ORDER BY task_date DESC  // ❌ 최신 → 과거
```

**문제**:
- 데이터가 역순으로 반환됨
- 차트에서 최신 날짜가 왼쪽에 표시됨

**해결**:
```typescript
ORDER BY task_date ASC  // ✅ 과거 → 최신
```

#### Frontend (app.js)
- 날짜 범위가 API에서 필터링된 데이터만 반환
- 데이터가 없는 날짜는 표시되지 않음

**예시**:
```
12/27: 작업 있음 → 표시 O
12/28: 작업 없음 → 표시 X ❌
12/29: 작업 있음 → 표시 O
```

**해결**:
- 7일 전체 날짜 생성 (데이터 유무 무관)
- 데이터 없는 날은 0% 표시

---

### 2️⃣ 주간 통계 문제 원인

#### 현재 구현
```typescript
// Backend: daily_trend 반환 (일별 데이터)
daily_trend: [
  {task_date: "2025-12-23", completion_rate: 75},
  {task_date: "2025-12-24", completion_rate: 80}
]
```

**문제**:
- 일별 통계와 동일한 데이터 구조
- 작업이 없는 날은 표시 안 됨
- 월~일 7일 전체가 표시되지 않음

#### 일별 vs 주간 차이점이 불명확

| 구분 | 현재 일별 | 현재 주간 | 기대되는 차이 |
|------|----------|----------|--------------|
| 기간 | 최근 7일 | 이번 주 (월~일) | ✅ |
| 그래프 | 선 그래프 | 막대 그래프 | ✅ |
| X축 | 날짜 (작업 있는 날만) | 날짜 (작업 있는 날만) | ❌ 주간은 7일 전체 |
| 데이터 | 7일 (가변) | 7일 (월~일 고정) | ❌ |

**해결 방향**:

**Option A: 주간 = 월~일 7일 전체 표시** ⭐ 권장
```
주간 통계 (12/23 월 ~ 12/29 일)
│
100% ┤     ││     ││
 80% ┤  ││ ││  ││ ││ ││
 60% ┤  ││ ││  ││ ││ ││ ││
  0% └──┴┴──┴┴──┴┴──┴┴──┴┴──┴┴──┴┴
     월  화  수  목  금  토  일
     
- 월~일 7일 모두 표시
- 데이터 없는 날은 0%
- 요일별 완료율 비교 용이
```

**Option B: 일별 통계 제거, 주간만 유지**
- 일별/주간이 너무 유사
- 주간 통계에 7일 전체 표시

---

### 3️⃣ 월별 통계 문제 원인

#### Backend 로직 (stats.ts Line 123)
```typescript
const endDate = new Date(year, month - 1, 1) // Current month start ❌
const startDate = new Date(year, month - 6, 1) // 6 months ago
```

**문제**:
- `endDate`가 "현재 월의 1일"로 설정됨
- 실제로는 현재 월 데이터가 포함되지 않음!

**예시**:
```javascript
currentStatsDate = 2025-12-29
year = 2025
month = 12

endDate = new Date(2025, 11, 1) = 2025-12-01  ❌ (12월 1일)
startDate = new Date(2025, 6, 1) = 2025-07-01

→ 2025-07-01 ~ 2025-12-01 범위
→ 12월 데이터는 12/1만 포함
```

**올바른 계산**:
```typescript
// 현재 월의 마지막 날
const endDate = new Date(year, month, 0) // 2025-12-31
const startDate = new Date(year, month - 6, 1) // 2025-07-01

→ 2025-07-01 ~ 2025-12-31 범위
→ 12월 전체 포함
```

#### 데이터가 없는 월 처리
```
현재: 작업이 있는 월만 표시
기대: 6개월 전체 표시 (작업 없으면 0%)

예:
7월: 데이터 없음 → 표시 X ❌
8월: 데이터 있음 → 표시 O
```

**해결**:
- 6개월 배열 미리 생성
- 데이터 없는 월은 0% 표시

---

## ✅ 해결 방안 요약

### 1️⃣ 일별 통계
```
수정 사항:
1. Backend: ORDER BY task_date ASC (정순 정렬)
2. Frontend: 7일 전체 날짜 생성 (데이터 없으면 0%)
3. X축: 12/27, 12/28, 12/29, ... (과거 → 최신)
```

### 2️⃣ 주간 통계
```
수정 사항:
1. Backend: 월~일 7일 전체 데이터 반환 (데이터 없으면 0%)
2. Frontend: 7일 전체 표시 (월, 화, 수, 목, 금, 토, 일)
3. X축: 요일 표시 (월, 화, 수, ...)
4. 막대 그래프 유지 (일별과 차별화)

차별화:
- 일별: 최근 7일 (가변 날짜, 선 그래프)
- 주간: 이번 주 월~일 (고정 요일, 막대 그래프)
```

### 3️⃣ 월별 통계
```
수정 사항:
1. Backend: endDate 계산 수정 (월 마지막 날)
2. Frontend: 6개월 전체 표시 (데이터 없으면 0%)
3. X축: 7월, 8월, 9월, 10월, 11월, 12월 (6개월 전체)
```

---

## 🎯 우선순위

### Priority 1: 일별 통계 수정 🔴
- 역순 정렬 → 정순 정렬
- 7일 전체 날짜 표시

### Priority 2: 월별 통계 수정 🔴
- endDate 계산 오류 수정
- 6개월 전체 표시

### Priority 3: 주간 통계 개선 🟡
- 월~일 7일 전체 표시
- 요일 표시 추가

---

## 🔧 구현 계획

### Step 1: Backend 수정
1. 일별 통계: `ORDER BY task_date ASC`
2. 월별 통계: `endDate` 계산 수정
3. 주간 통계: 데이터 없는 날 0% 반환

### Step 2: Frontend 수정
1. 일별: 7일 전체 날짜 배열 생성
2. 주간: 월~일 7일 고정, 요일 표시
3. 월별: 6개월 전체 배열 생성

### Step 3: 테스트
1. 데이터 없는 날/주/월 확인
2. 날짜 정렬 확인
3. X축 레이블 확인

---

## 📊 기대 결과

### 일별 통계 (After)
```
최근 7일
│
100% ┤        ╭─╮
 80% ┤     ╭─╯ ╰─╮
 60% ┤  ╭─╯      ╰─╮
  0% └────────────────
     12/27 12/28 12/29 12/30 12/31 1/1 1/2
     (과거 → 최신 순서)
```

### 주간 통계 (After)
```
이번 주 (12/23 월 ~ 12/29 일)
│
100% ┤     ││     ││
 80% ┤  ││ ││  ││ ││ ││
 60% ┤  ││ ││  ││ ││ ││ ││
  0% └──┴┴──┴┴──┴┴──┴┴──┴┴──┴┴──┴┴
     월  화  수  목  금  토  일
     (7일 전체 표시)
```

### 월별 통계 (After)
```
최근 6개월
│
100% ┤      ╭─╮
 80% ┤   ╭─╯ ╰╮
 60% ┤ ╭─╯    ╰─╮
  0% └────────────────
     7월 8월 9월 10월 11월 12월
     (6개월 전체 표시)
```

---

## ❓ 진행 방향 결정

어떻게 수정할까요?

**Option A**: 3가지 모두 수정 (권장) ⭐
- 일별: 정렬 + 7일 전체
- 주간: 7일 전체 + 요일 표시
- 월별: endDate 수정 + 6개월 전체

**Option B**: 우선순위대로 단계적 수정
- 1단계: 일별 + 월별 (긴급)
- 2단계: 주간 (개선)

**Option C**: 일별/주간 통합
- 주간 통계만 유지 (7일 전체 표시)
- 일별 통계 제거

선택해주시면 즉시 구현하겠습니다! 🚀
